<!DOCTYPE html>
<html>
<head>
	<title>Repository Commit Heatmap</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
			padding: 20px;
			background: white;
			max-width: 1200px;
			margin: 0 auto;
		}

		h2 {
			margin-bottom: 20px;
		}

		.config {
			margin: 20px 0;
			padding: 15px;
			background: #f5f5f5;
			border-radius: 5px;
			display: flex;
			gap: 15px;
			align-items: flex-end;
		}

		.config-group {
			display: flex;
			flex-direction: column;
		}

		.config label {
			font-weight: bold;
			margin-bottom: 5px;
			font-size: 14px;
		}

		.config input {
			padding: 8px;
			width: 200px;
			border: 1px solid #ddd;
			border-radius: 4px;
			font-size: 14px;
		}

		.config button {
			padding: 8px 16px;
			background: #0366d6;
			color: white;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			font-size: 14px;
			font-weight: bold;
		}

		.config button:hover {
			background: #0256c7;
		}

		#error {
			color: red;
			margin: 15px 0;
			padding: 10px;
			background: #ffe6e6;
			border-radius: 4px;
			display: none;
		}

		#loading {
			color: #666;
			margin: 15px 0;
			font-style: italic;
			display: none;
		}

		#heatmap-container {
			margin-top: 30px;
			overflow-x: auto;
		}

		.heatmap-wrapper {
			display: flex;
			gap: 10px;
		}

		.heatmap-section {
			display: flex;
			flex-direction: column;
		}

		.heatmap-label-container {
			display: flex;
			gap: 4px;
			margin-bottom: 10px;
		}

		.month-label {
			display: flex;
			flex-direction: column;
			align-items: center;
		}

		.month-text {
			font-size: 12px;
			font-weight: bold;
			color: #333;
			height: 18px;
			display: flex;
			align-items: center;
			white-space: nowrap;
		}

		.heatmap-grid {
			display: flex;
			flex-direction: column;
			gap: 2px;
		}

		.heatmap-row {
			display: flex;
			gap: 2px;
		}

		.day-labels {
			display: flex;
			flex-direction: column;
			gap: 2px;
			margin-right: 8px;
			justify-content: flex-end;
		}

		.day-label {
			width: 20px;
			height: 14px;
			font-size: 11px;
			color: #666;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: 500;
		}

		.heatmap-cell {
			width: 14px;
			height: 14px;
			border-radius: 2px;
			cursor: pointer;
			border: 1px solid #e0e0e0;
		}

		.heatmap-cell[data-count="0"] {
			background-color: #ebedf0;
		}

		.heatmap-cell[data-count="1"] {
			background-color: #9be9a8;
		}

		.heatmap-cell[data-count="2"] {
			background-color: #40c463;
		}

		.heatmap-cell[data-count="3"] {
			background-color: #30a14e;
		}

		.heatmap-cell[data-count="4"],
		.heatmap-cell[data-count="5"] {
			background-color: #216e39;
		}

		.legend {
			display: flex;
			gap: 10px;
			margin-top: 20px;
			font-size: 12px;
		}

		.legend-item {
			display: flex;
			align-items: center;
			gap: 5px;
		}

		.legend-cell {
			width: 12px;
			height: 12px;
			border-radius: 2px;
		}

		#stats {
			margin-top: 20px;
			padding: 10px;
			background: #f9f9f9;
			border-radius: 4px;
			font-size: 14px;
		}
	</style>
</head>
<body>
	<h2>ðŸ“Š ClimbLog Commit Heatmap</h2>

	<div class="config">
		<div class="config-group">
			<label>GitHub Username:</label>
			<input type="text" id="username" value="Chloezhu010" placeholder="e.g., Chloezhu010">
		</div>

		<div class="config-group">
			<label>Repository Name:</label>
			<input type="text" id="repo" value="ClimbLog" placeholder="e.g., ClimbLog">
		</div>

		<button onclick="loadHeatmap()">Load Commits</button>
	</div>

	<div id="error"></div>
	<div id="loading">Loading commits...</div>
	<div id="heatmap-container"></div>
	<div id="stats"></div>

	<script>
		async function fetchCommits(username, repo) {
			console.log(`Fetching commits for ${username}/${repo}...`);
			const response = await fetch(
				`https://api.github.com/repos/${username}/${repo}/commits?per_page=100`
			);

			console.log(`Response status: ${response.status}`);

			if (!response.ok) {
				throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
			}

			const commits = await response.json();
			console.log(`Received data:`, commits);

			if (!Array.isArray(commits)) {
				throw new Error('Unexpected API response format - not an array');
			}

			if (commits.length === 0) {
				throw new Error('No commits found for this repository');
			}

			// Count commits per day
			const data = {};
			commits.forEach(commit => {
				const dateStr = commit.commit.author.date;
				const date = new Date(dateStr);
				const dayKey = date.toISOString().split('T')[0]; // YYYY-MM-DD
				data[dayKey] = (data[dayKey] || 0) + 1;
			});

			console.log(`Loaded ${commits.length} commits, ${Object.keys(data).length} unique days`);
			return { data, commits };
		}

		function createHeatmap(data) {
			const container = document.getElementById('heatmap-container');
			container.innerHTML = '';

			const sixMonthsAgo = new Date();
			sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);

			const weeks = [];
			let currentWeek = [];
			let currentDate = new Date(sixMonthsAgo);

			// Start from the beginning of the week (Sunday)
			currentDate.setDate(currentDate.getDate() - currentDate.getDay());

			while (currentDate < new Date()) {
				const dayKey = currentDate.toISOString().split('T')[0];
				const count = data[dayKey] || 0;
				currentWeek.push({ date: new Date(currentDate), count });

				if (currentWeek.length === 7) {
					weeks.push(currentWeek);
					currentWeek = [];
				}

				currentDate.setDate(currentDate.getDate() + 1);
			}

			if (currentWeek.length > 0) {
				weeks.push(currentWeek);
			}

			// Create wrapper
			const wrapper = document.createElement('div');
			wrapper.className = 'heatmap-wrapper';

			// Add day-of-week labels on the left
			const dayLabelsContainer = document.createElement('div');
			dayLabelsContainer.className = 'day-labels';
			const dayNames = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
			dayNames.forEach(day => {
				const label = document.createElement('div');
				label.className = 'day-label';
				label.textContent = day;
				dayLabelsContainer.appendChild(label);
			});
			wrapper.appendChild(dayLabelsContainer);

			// Create heatmap grid with month labels
			const gridContainer = document.createElement('div');
			gridContainer.className = 'heatmap-section';

			// Month label row
			const monthLabelContainer = document.createElement('div');
			monthLabelContainer.className = 'heatmap-label-container';
			const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
			let currentMonth = sixMonthsAgo.getMonth();
			let lastMonth = -1;
			let monthWeekCount = 0;

			for (let week = 0; week < weeks.length; week++) {
				const weekMonth = weeks[week][0].date.getMonth();
				if (weekMonth !== lastMonth) {
					if (monthWeekCount > 0) {
						const monthLabel = document.createElement('div');
						monthLabel.className = 'month-label';
						monthLabel.style.width = (monthWeekCount * 16) + 'px'; // width of weeks
						monthLabel.innerHTML = `<div class="month-text">${monthNames[lastMonth === -1 ? currentMonth : lastMonth]}</div>`;
						monthLabelContainer.appendChild(monthLabel);
					}
					lastMonth = weekMonth;
					monthWeekCount = 1;
				} else {
					monthWeekCount++;
				}
			}
			// Add last month label
			if (monthWeekCount > 0) {
				const monthLabel = document.createElement('div');
				monthLabel.className = 'month-label';
				monthLabel.style.width = (monthWeekCount * 16) + 'px';
				monthLabel.innerHTML = `<div class="month-text">${monthNames[lastMonth]}</div>`;
				monthLabelContainer.appendChild(monthLabel);
			}
			gridContainer.appendChild(monthLabelContainer);

			// Create grid
			const grid = document.createElement('div');
			grid.className = 'heatmap-grid';

			// Transpose to display weeks as columns
			const maxWeeks = weeks.length;
			for (let dayOfWeek = 0; dayOfWeek < 7; dayOfWeek++) {
				const row = document.createElement('div');
				row.className = 'heatmap-row';

				for (let week = 0; week < maxWeeks; week++) {
					if (weeks[week][dayOfWeek]) {
						const { date, count } = weeks[week][dayOfWeek];
						const cell = document.createElement('div');
						cell.className = 'heatmap-cell';
						cell.setAttribute('data-count', Math.min(count, 5)); // Cap at 5 for color
						cell.title = `${date.toDateString()}: ${count} commit${count !== 1 ? 's' : ''}`;
						row.appendChild(cell);
					}
				}

				grid.appendChild(row);
			}

			gridContainer.appendChild(grid);
			wrapper.appendChild(gridContainer);
			container.appendChild(wrapper);

			// Add legend
			const legend = document.createElement('div');
			legend.className = 'legend';
			legend.style.marginTop = '20px';
			legend.innerHTML = `
				<span>Less</span>
				<div class="legend-item">
					<div class="legend-cell" data-count="0" style="background-color: #ebedf0;"></div>
				</div>
				<div class="legend-item">
					<div class="legend-cell" data-count="1" style="background-color: #9be9a8;"></div>
				</div>
				<div class="legend-item">
					<div class="legend-cell" data-count="2" style="background-color: #40c463;"></div>
				</div>
				<div class="legend-item">
					<div class="legend-cell" data-count="3" style="background-color: #30a14e;"></div>
				</div>
				<div class="legend-item">
					<div class="legend-cell" data-count="4" style="background-color: #216e39;"></div>
				</div>
				<span>More</span>
			`;
			container.appendChild(legend);
		}

		async function loadHeatmap() {
			const username = document.getElementById('username').value.trim();
			const repo = document.getElementById('repo').value.trim();
			const errorDiv = document.getElementById('error');
			const loadingDiv = document.getElementById('loading');
			const statsDiv = document.getElementById('stats');

			// Reset states
			errorDiv.style.display = 'none';
			errorDiv.textContent = '';
			loadingDiv.style.display = 'block';
			statsDiv.textContent = '';
			document.getElementById('heatmap-container').innerHTML = '';

			if (!username || !repo) {
				errorDiv.textContent = 'Please enter both username and repository name';
				errorDiv.style.display = 'block';
				loadingDiv.style.display = 'none';
				return;
			}

			try {
				const { data, commits } = await fetchCommits(username, repo);
				loadingDiv.style.display = 'none';

				createHeatmap(data);

				const totalDaysWithCommits = Object.keys(data).length;
				const totalCommits = commits.length;
				statsDiv.innerHTML = `
					<strong>Stats:</strong> ${totalCommits} commits on ${totalDaysWithCommits} days
				`;
			} catch (error) {
				loadingDiv.style.display = 'none';
				errorDiv.textContent = `Error: ${error.message}`;
				errorDiv.style.display = 'block';
				console.error('Failed to load heatmap:', error);
			}
		}

		// Load heatmap on page load with default values
		window.addEventListener('load', loadHeatmap);
	</script>
</body>
</html>